<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Profit/Loss Calculator</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background-color: #f4f4f4; }
        h1 { text-align: center; color: #333; }
        .calculator { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        label { display: block; margin: 10px 0 5px; font-weight: bold; }
        input { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 10px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #218838; }
        #result, #purchases { margin-top: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; background-color: #e9ecef; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f8f9fa; }
        #error { color: red; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>Bitcoin Profit/Loss Calculator</h1>
        <label for="buyPrice">Price Bought At (USD per BTC):</label>
        <input type="number" id="buyPrice" step="0.01" placeholder="e.g., 50000">
        <label for="amount">Amount of Bitcoin (BTC):</label>
        <input type="number" id="amount" step="0.00000001" placeholder="e.g., 0.5">
        <label for="buyDate">Purchase Date:</label>
        <input type="date" id="buyDate">
        <button onclick="addPurchase()">Add Purchase</button>
        <label for="currentPrice">Current Bitcoin Price (USD per BTC):</label>
        <input type="number" id="currentPrice" step="0.01" placeholder="Fetching live price..." readonly>
        <button onclick="calculate()">Calculate Total Profit/Loss</button>
        <div id="purchases">
            <h3>Your Purchases</h3>
            <table id="purchaseTable">
                <thead><tr><th>Date</th><th>Buy Price (USD)</th><th>Amount (BTC)</th><th>Investment (USD)</th></tr></thead>
                <tbody id="purchaseList"></tbody>
            </table>
        </div>
        <div id="result"></div>
        <div id="error"></div>
    </div>
    <script>
        let purchases = JSON.parse(localStorage.getItem('bitcoinPurchases')) || [];
        async function fetchLivePrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
                const data = await response.json();
                const price = data.bitcoin.usd;
                document.getElementById('currentPrice').value = price.toFixed(2);
                document.getElementById('error').innerHTML = '';
            } catch (error) {
                document.getElementById('error').innerHTML = 'Failed to fetch live Bitcoin price. Please check your internet connection.';
            }
        }
        function loadPurchases() {
            const purchaseList = document.getElementById('purchaseList');
            purchaseList.innerHTML = '';
            purchases.sort((a, b) => new Date(a.date) - new Date(b.date));
            purchases.forEach((purchase, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${purchase.date}</td><td>$${parseFloat(purchase.buyPrice).toFixed(2)}</td><td>${parseFloat(purchase.amount).toFixed(8)}</td><td>$${(purchase.buyPrice * purchase.amount).toFixed(2)}</td>`;
                purchaseList.appendChild(row);
            });
        }
        function addPurchase() {
            const buyPrice = parseFloat(document.getElementById('buyPrice').value);
            const amount = parseFloat(document.getElementById('amount').value);
            const buyDate = document.getElementById('buyDate').value;
            const errorDiv = document.getElementById('error');
            if (isNaN(buyPrice) || isNaN(amount) || !buyDate || buyPrice <= 0 || amount <= 0) {
                errorDiv.innerHTML = 'Please enter valid positive numbers for price, amount, and a valid date.';
                return;
            }
            purchases.push({ buyPrice, amount, date: buyDate });
            localStorage.setItem('bitcoinPurchases', JSON.stringify(purchases));
            loadPurchases();
            errorDiv.innerHTML = 'Purchase added successfully!';
            document.getElementById('buyPrice').value = '';
            document.getElementById('amount').value = '';
            document.getElementById('buyDate').value = '';
        }
        function calculate() {
            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const resultDiv = document.getElementById('result');
            const errorDiv = document.getElementById('error');
            if (isNaN(currentPrice) || currentPrice <= 0) {
                errorDiv.innerHTML = 'Please ensure a valid current Bitcoin price is loaded.';
                return;
            }
            if (purchases.length === 0) {
                errorDiv.innerHTML = 'No purchases added yet.';
                return;
            }
            let totalInvestment = 0;
            let totalCurrentValue = 0;
            let totalAmount = 0;
            purchases.forEach(purchase => {
                const investment = purchase.buyPrice * purchase.amount;
                const currentValue = currentPrice * purchase.amount;
                totalInvestment += investment;
                totalCurrentValue += currentValue;
                totalAmount += purchase.amount;
            });
            const totalProfitLoss = totalCurrentValue - totalInvestment;
            const totalProfitLossPercentage = totalInvestment > 0 ? ((totalCurrentValue - totalInvestment) / totalInvestment * 100).toFixed(2) : 0;
            let resultText = `
                <strong>Total Bitcoin Owned:</strong> ${totalAmount.toFixed(8)} BTC<br>
                <strong>Total Investment:</strong> $${totalInvestment.toFixed(2)}<br>
                <strong>Total Current Value:</strong> $${totalCurrentValue.toFixed(2)}<br>
                <strong>Total Profit/Loss:</strong> $${totalProfitLoss.toFixed(2)}<br>
                <strong>Total Profit/Loss Percentage:</strong> ${totalProfitLossPercentage}%
            `;
            resultDiv.style.color = totalProfitLoss >= 0 ? 'green' : 'red';
            resultDiv.innerHTML = resultText;
            errorDiv.innerHTML = '';
        }
        fetchLivePrice();
        loadPurchases();
        setInterval(fetchLivePrice, 60000);
    </script>
</body>
</html>
